# NestJS + Directus Starter

–°—Ç–∞—Ä—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ NestJS —Å –∞–¥–º–∏–Ω–∫–æ–π –Ω–∞ Directus.

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç:

- **NestJS** - –æ—Å–Ω–æ–≤–Ω–æ–π backend —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å PostgreSQL –≤ Docker
- **Directus** - –∞–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ NestJS)
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å volume –≤ git
- **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - NestJS –∏ Directus –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ë–î

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
starter/
‚îú‚îÄ‚îÄ server/                    # NestJS Backend + PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml    # PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ database/postgres/    # –î–∞–Ω–Ω—ã–µ –ë–î (volume –≤ git)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ directus/                 # Directus CMS (–ê–¥–º–∏–Ω–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yaml  # Directus –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `server/` - NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + PostgreSQL –≤ Docker
  - `dist/backups/` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (.sql.gz)
- `directus/` - Directus CMS –∏ –∞–¥–º–∏–Ω–∫–∞ (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ Server)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–æ—Ç–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ NestJS** —Å TypeORM –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- **–ê–¥–º–∏–Ω–∫–∞ –Ω–∞ Directus** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - NestJS –∏ Directus –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É PostgreSQL
- **Volume –≤ git** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** - –ø—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - —Ü–≤–µ—Ç–∞, —Ç–µ–º—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ git
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Directus** - –≤—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Directus
- **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤** - Guards –∏ Decorators –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** - 30-—Å–µ–∫—É–Ω–¥–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–∞—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î** - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** - –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Directus –≤ git
- ‚úÖ **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- ‚úÖ **–ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å—Ä–µ–¥–∞–º–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
   ```bash
   cd server
   docker-compose up -d
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Directus:
   ```bash
   cd directus
   docker-compose up -d
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ NestJS —Å–µ—Ä–≤–µ—Ä:
   ```bash
   cd server
   npm install
   npm run start:dev
   ```

## –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

- **Directus –∞–¥–º–∏–Ω–∫–∞**: http://localhost:8055
- **NestJS API**: http://localhost:5000
- **PostgreSQL**: localhost:5433

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger)

- **Swagger Directus API**: http://localhost:3000/directus#/
- **Swagger –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: http://localhost:3000/api#/

‚úÖ **Swagger –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ Swagger –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å `credentials: 'include'`, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏.

üí° **–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `credentials: 'include'` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö fetch/axios –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Directus.

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: Directus –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É `access_token` –∏ `directus_refresh_token` –≤ httpOnly cookies –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –í—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Directus. NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω—ã Directus –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **DirectusService**, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä—è–º—É—é —á–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã Directus –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

- `directus_access` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Ä–æ–ª–µ–π —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
- `directus_permissions` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º Directus –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ **30 —Å–µ–∫—É–Ω–¥** –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤.

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:**
1. `UserAuthGuard` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω –∏–∑ cookies
2. `PermissionsGuard` —á–µ—Ä–µ–∑ `DirectusService` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Å –ø—Ä–∞–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ:**
```typescript
@Controller('page')
@UseGuards(UserAuthGuard, PermissionsGuard)
export class PageController {
  // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
  @Get()
  @Permissions(['read page'])
  findAll() { ... }

  // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
  @Post()
  @Permissions(['create page'])
  create() { ... }

  // –¢—Ä–µ–±—É—é—Ç—Å—è –æ–±–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–æ–ø–µ—Ä–∞—Ç–æ—Ä 'and')
  @Put(':id')
  @Permissions(['read page', 'update page'], 'and')
  update() { ... }
}
```

## –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤** - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00 –Ω–æ—á–∏
- **–°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ –±—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ .sql.gz
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `BackupService` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `postgresDB`
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è: `server/dist/backups/`
- –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤: `backup-YYYY-MM-DD.sql.gz`

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞ –≤—Ä—É—á–Ω—É—é –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ —Å–µ—Ä–≤–∏—Å–∞:
```typescript
await backupService.handleBackup();
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Cron` –≤ `backup.service.ts`:
```typescript
@Cron(CronExpression.EVERY_DAY_AT_2AM) // –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```
